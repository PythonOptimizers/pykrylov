

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The Conjugate Gradient Method &mdash; PyKrylov 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="PyKrylov 0.1 documentation" href="index.html" />
    <link rel="next" title="The Conjugate Gradient Squared Method" href="cgs.html" />
    <link rel="prev" title="Generic Template for Krylov Methods" href="generic.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <div class="headertitle"><a
          href="contents.html">PyKrylov 0.1 documentation</a></div>
        <div class="rel">
          <a href="generic.html" title="Generic Template for Krylov Methods"
             accesskey="P">previous</a> |
          <a href="cgs.html" title="The Conjugate Gradient Squared Method"
             accesskey="N">next</a> |
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-conjugate-gradient-method">
<span id="cg-page"></span><h1>The Conjugate Gradient Method<a class="headerlink" href="#the-conjugate-gradient-method" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-cg">
<span id="the-cg-module"></span><h2>The <a class="reference internal" href="#module-cg" title="cg"><tt class="xref py py-mod docutils literal"><span class="pre">cg</span></tt></a> Module<a class="headerlink" href="#module-cg" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cg.CG">
<em class="property">class </em><tt class="descclassname">cg.</tt><tt class="descname">CG</tt><big>(</big><em>matvec</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cg.CG" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">pykrylov.generic.generic.KrylovMethod</span></tt></p>
<p>A pure Python implementation of the conjugate gradient (CG) algorithm. The
conjugate gradient algorithm may be used to solve symmetric positive
definite systems of linear equations, i.e., systems of the form</p>
<blockquote>
<div>A x = b</div></blockquote>
<p>where the matrix A is square, symmetric and positive definite. This is
equivalent to solving the unconstrained convex quadratic optimization
problem</p>
<blockquote>
<div>minimize    -&lt;b,x&gt; + 1/2 &lt;x, Ax&gt;</div></blockquote>
<p>in the variable x.</p>
<p>CG performs 1 matrix-vector product, 2 dot products and 3 daxpys per
iteration.</p>
<p>If a preconditioner is supplied, it needs to solve one preconditioning
system per iteration. Our implementation is standard and follows <a class="reference internal" href="generic.html#kelley">[Kelley]</a>
and <a class="reference internal" href="generic.html#templates">[Templates]</a>.</p>
<dl class="method">
<dt id="cg.CG.solve">
<tt class="descname">solve</tt><big>(</big><em>rhs</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cg.CG.solve" title="Permalink to this definition">¶</a></dt>
<dd><p>Solve a linear system with <cite>rhs</cite> as right-hand side by the CG method.
The vector <cite>rhs</cite> should be a Numpy array.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords :</th><td class="field-body"><table class="first last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">guess:</th><td class="field-body">Initial guess (Numpy array). Default: 0.</td>
</tr>
<tr class="field-even field"><th class="field-name">matvec_max:</th><td class="field-body">Max. number of matrix-vector produts. Default: 2n.</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">check_curvature:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body">Ensure matrix is positive definte. Default: True.</td>
</tr>
<tr class="field-even field"><th class="field-name">store_resids:</th><td class="field-body">Store full residual vector history. Default: False.</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>The following script runs through a list of symmetric positive definite matrices
in <a class="reference external" href="http://math.nist.gov/MatrixMarket">Matrix Market</a> format, builds
the right-hand side so that the exact solution of the system is the vector of
ones, and applies the conjugate gradient to each of them. The sparse matrices
are handled by way of the <a class="reference external" href="http://pysparse.sf.net">Pysparse</a> package.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pykrylov.cg</span> <span class="kn">import</span> <span class="n">CG</span>
<span class="kn">from</span> <span class="nn">pysparse</span> <span class="kn">import</span> <span class="n">spmatrix</span>
<span class="kn">from</span> <span class="nn">pysparse.pysparseMatrix</span> <span class="kn">import</span> <span class="n">PysparseMatrix</span> <span class="k">as</span> <span class="n">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="n">matrices</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;1138bus.mtx&#39;</span><span class="p">,</span> <span class="s">&#39;bcsstk08.mtx&#39;</span><span class="p">,</span> <span class="s">&#39;bcsstk09.mtx&#39;</span><span class="p">,</span> <span class="s">&#39;bcsstk10.mtx&#39;</span><span class="p">]</span>
<span class="n">matrices</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;bcsstk11.mtx&#39;</span><span class="p">,</span> <span class="s">&#39;bcsstk18.mtx&#39;</span><span class="p">,</span> <span class="s">&#39;bcsstk19.mtx&#39;</span> <span class="p">]</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%15s</span><span class="s">  </span><span class="si">%5s</span><span class="s">  </span><span class="si">%5s</span><span class="s">  </span><span class="si">%8s</span><span class="s">  </span><span class="si">%8s</span><span class="s">  </span><span class="si">%8s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;Name&#39;</span><span class="p">,</span> <span class="s">&#39;Size&#39;</span><span class="p">,</span> <span class="s">&#39;Mult&#39;</span><span class="p">,</span>
                                         <span class="s">&#39;Resid0&#39;</span><span class="p">,</span> <span class="s">&#39;Resid&#39;</span><span class="p">,</span> <span class="s">&#39;Error&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">hdr</span>

<span class="k">for</span> <span class="n">matName</span> <span class="ow">in</span> <span class="n">matrices</span><span class="p">:</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">sp</span><span class="p">(</span> <span class="n">matrix</span><span class="o">=</span><span class="n">spmatrix</span><span class="o">.</span><span class="n">ll_mat_from_mtx</span><span class="p">(</span><span class="n">matName</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">rhs</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">e</span>
    <span class="n">cg</span> <span class="o">=</span> <span class="n">CG</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">matvec_max</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
    <span class="n">cg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cg</span><span class="o">.</span><span class="n">bestSolution</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="si">%15s</span><span class="s">  </span><span class="si">%5d</span><span class="s">  </span><span class="si">%5d</span><span class="s">  </span><span class="si">%8.2e</span><span class="s">  </span><span class="si">%8.2e</span><span class="s">  </span><span class="si">%8.2e</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">matName</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">cg</span><span class="o">.</span><span class="n">nMatvec</span><span class="p">,</span>
                                                   <span class="n">cg</span><span class="o">.</span><span class="n">residNorm0</span><span class="p">,</span>
                                                   <span class="n">cg</span><span class="o">.</span><span class="n">residNorm</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
<p>The script above produces the following output:</p>
<div class="highlight-python"><pre>        Name   Size   Mult    Resid0     Resid     Error
 1138bus.mtx   1138   1759  1.46e+03  1.44e-03  1.30e-05
bcsstk08.mtx   1074   1255  8.74e+10  7.41e+04  7.54e-02
bcsstk09.mtx   1083    180  3.17e+08  1.84e+02  8.59e-06
bcsstk10.mtx   1086   1753  8.10e+07  7.30e+01  1.04e-03
bcsstk11.mtx   1473   1689  5.43e+09  4.88e+03  5.68e-02
bcsstk18.mtx  11948   9729  2.79e+11  2.49e+05  2.85e-01
bcsstk19.mtx    817    468  1.34e+15  1.26e+09  8.09e-01</pre>
</div>
<p>Note that the default relative stopping tolerance is <cite>1.0e-6</cite> and is achieved in
all cases.</p>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="generic.html">Generic Template</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Conjugate Gradient</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-cg">The <tt class="docutils literal"><span class="pre">cg</span></tt> Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cgs.html">Conjugate Gradient Squared</a></li>
<li class="toctree-l1"><a class="reference internal" href="bicgstab.html">Bi-Conjugate Gradient Stabilized</a></li>
<li class="toctree-l1"><a class="reference internal" href="tfqmr.html">Transpose-Free Quasi-Minimum Residual</a></li>
<li class="toctree-l1"><a class="reference internal" href="symmlq.html">Symmetric Indefinite Method with Orthogonal Factorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="bmark.html">Benchmarking Solvers</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="generic.html" title="Generic Template for Krylov Methods"
             >previous</a> |
          <a href="cgs.html" title="The Conjugate Gradient Squared Method"
             >next</a> |
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="genindex.html" title="General Index"
             >index</a>
            <br/>
            <a href="_sources/cg.txt"
               rel="nofollow">Show Source</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2008, D. Orban.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>